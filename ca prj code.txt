// Created by Simple Circuits

#include <Wire.h>               // Library for I2C communication (used by LCD)
#include <LiquidCrystal_I2C.h>  // Library for I2C LCD
#include <Servo.h>              // Library to control servo motors

LiquidCrystal_I2C lcd(0x27, 16, 2);  // Create LCD object at I2C address 0x27, 16 cols x 2 rows
Servo myservo;                        // Create servo object

// Define IR sensor pins
int IR1 = 2;  // Entry sensor
int IR2 = 3;  // Exit sensor

int Slot = 4; // Total number of parking slots initially available

// Flags to prevent multiple triggers in loop
int flag1 = 0;
int flag2 = 0;

void setup() {
  Serial.begin(9600);      // Start serial communication for debugging (optional)

  lcd.init();               // Initialize the LCD
  lcd.backlight();          // Turn on the LCD backlight

  // Set IR sensor pins as input with internal pull-up resistors to avoid floating values
  pinMode(IR1, INPUT_PULLUP);  
  pinMode(IR2, INPUT_PULLUP);

  // Attach servo to pin 5 (changed from 4 to avoid conflict with IR sensors)
  myservo.attach(5);       
  myservo.write(100);       // Close the gate initially (100 = closed position)

  // Display welcome message on LCD
  lcd.setCursor(0, 0);      
  lcd.print("     R.E.S    ");
  lcd.setCursor(0, 1);
  lcd.print(" SMART PARKING ");
  delay(2000);              // Wait 2 seconds
  lcd.clear();              // Clear the LCD for main display
}

void loop() {
  // Check entry sensor (IR1)
  if (digitalRead(IR1) == LOW && flag1 == 0) {  // Trigger when a car arrives
    if (Slot > 0) {                             // Check if any slots are available
      flag1 = 1;                                // Set flag to prevent repeated trigger
      if (flag2 == 0) {                         // Only open gate if exit sensor not triggered
        delay(1000);
        myservo.write(0);                       // Open gate
        Slot = Slot - 1;                        // Decrease available slots
        delay(5000);
        myservo.write(100);                       
      }
      flag1 = 0;
    } else {
      // No slots available: show message on LCD
      lcd.setCursor(0, 0);
      lcd.print("    SORRY :(    ");
      lcd.setCursor(0, 1);
      lcd.print("  Parking Full  ");
      delay(3000);
      lcd.clear();
    }
  }

  // Check exit sensor (IR2)
  if (digitalRead(IR2) == LOW && flag2 == 0) {  // Trigger when a car leaves
    flag2 = 1;                                  // Set flag
    if (flag1 == 0 && Slot < 4) {                           // Only open gate if entry not triggered
      delay(1000);
      myservo.write(0);                         // Open gate
      Slot = Slot + 1;                          // Increase available slots
      delay(5000);
      myservo.write(100);       
    }
    flag2 = 0;
  }

  // Display current parking info on LCD
  lcd.setCursor(0, 0);
  lcd.print("    WELCOME!    ");
  lcd.setCursor(0, 1);
  lcd.print("Slot Left: ");
  lcd.print(Slot);
}

